app-id: io.github.jonathands.S3BucketDiver
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: s3-bucket-diver

finish-args:
  # GUI access
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  
  # Network access for S3 connections
  - --share=network
  
  # File system access for downloads/uploads
  - --filesystem=home
  - --filesystem=xdg-download
  
  # Clipboard access for copy URL functionality
  - --socket=session-bus

modules:
  - name: python3-pyqt6
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --prefix=${FLATPAK_DEST} "PyQt6==6.4.2"
    build-options:
      build-args:
        - --share=network
    sources: []

  - name: python3-boto3
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} "boto3==1.34.144" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/9a/b0/a4301290ea6cdbb0cda7048ae11b0e560eacca7d2c2e64e6b3d5a9fb3fde/boto3-1.34.144-py3-none-any.whl
        sha256: b8433d481d50b68a0162c0379c0dd4aabfc3d1ad901800beb5b87815997511c1
      - type: file
        url: https://files.pythonhosted.org/packages/24/4b/956a80d406dfffba1f8f7fbaba7dd73d418ed8a7b95faa1ade7cf17663a5/botocore-1.34.144-py3-none-any.whl
        sha256: a2cf26e1bf10d5917a2285e50257bc44e94a1d16574f282f3274f7a5d8d1f08b
      - type: file
        url: https://files.pythonhosted.org/packages/31/b4/b9b800c45527aadd64d5b442f9b932b00648617eb5d63d2c7a6587b7cafc/jmespath-1.0.1-py3-none-any.whl
        sha256: 02e2e4cc71b5bcab88332eebf907519190dd9e6e82107fa7f83b1003a6252980
      - type: file
        url: https://files.pythonhosted.org/packages/ec/57/56b9bcc3c9c6a792fcbaf139543cee77261f3651ca9da0c93f5c1221264b/python_dateutil-2.9.0.post0-py2.py3-none-any.whl
        sha256: a8b2bc7bffae282281c8140a97d3aa9c14da0b136dfe83f850eea9a5f7470427
      - type: file
        url: https://files.pythonhosted.org/packages/66/05/7957af15543b8c9799209506df4660cba7afc4cf94bfb60513827e96bed6/s3transfer-0.10.4-py3-none-any.whl
        sha256: 244a76a24355363a68164241438de1b72f8781664920260c48465896b712a41e
      - type: file
        url: https://files.pythonhosted.org/packages/a7/c2/fe1e52489ae3122415c51f387e221dd0773709bad6c6cdaa599e8a2c5185/urllib3-2.5.0-py3-none-any.whl
        sha256: e6b01673c0fa6a13e374b50871808eb3bf7046c4b125b216f6bf1cc604cff0dc

  - name: python3-requests
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} "requests==2.31.0" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e5/48/1549795ba7742c948d2ad169c1c8cdbae65bc450d6cd753d124b17c8cd32/certifi-2025.8.3-py3-none-any.whl
        sha256: f6c12493cfb1b06ba2ff328595af9350c65d6644968e5d3a2ffd78699af217a5
      - type: file
        url: https://files.pythonhosted.org/packages/83/2d/5fd176ceb9b2fc619e63405525573493ca23441330fcdaee6bef9460e924/charset_normalizer-3.4.3.tar.gz
        sha256: 6fce4b8500244f6fcb71465d4a4930d132ba9ab8e71a7859e6a5d59851068d14
      - type: file
        url: https://files.pythonhosted.org/packages/76/c6/c88e154df9c4e1a2a66ccf0005a88dfb2650c1dffb6f5ce603dfbd452ce3/idna-3.10-py3-none-any.whl
        sha256: 946d195a0d259cbba61165e88e65941f16e9b36ea6ddb97f00452bae8b1287d3
      - type: file
        url: https://files.pythonhosted.org/packages/70/8e/0e2d847013cb52cd35b38c009bb167a1a26b2ce6cd6965bf26b47bc0bf44/requests-2.31.0-py3-none-any.whl
        sha256: 58cd2187c01e70e6e26505bca751777aa9f2ee0b7f4300988b709f44e013003f
      - type: file
        url: https://files.pythonhosted.org/packages/a7/c2/fe1e52489ae3122415c51f387e221dd0773709bad6c6cdaa599e8a2c5185/urllib3-2.5.0-py3-none-any.whl
        sha256: e6b01673c0fa6a13e374b50871808eb3bf7046c4b125b216f6bf1cc604cff0dc

  - name: s3-bucket-diver
    buildsystem: simple
    build-commands:
      - install -Dm755 s3-bucket-diver ${FLATPAK_DEST}/bin/s3-bucket-diver
      - install -Dm644 io.github.jonathands.S3BucketDiver.desktop ${FLATPAK_DEST}/share/applications/io.github.jonathands.S3BucketDiver.desktop
      - install -Dm644 io.github.jonathands.S3BucketDiver.metainfo.xml ${FLATPAK_DEST}/share/metainfo/io.github.jonathands.S3BucketDiver.metainfo.xml
      - mkdir -p ${FLATPAK_DEST}/lib/s3-bucket-diver
      - cp -r backend/ ${FLATPAK_DEST}/lib/s3-bucket-diver/
      - cp -r ui/ ${FLATPAK_DEST}/lib/s3-bucket-diver/
      - cp -r resources/ ${FLATPAK_DEST}/lib/s3-bucket-diver/
      - cp s3_browser_app.py ${FLATPAK_DEST}/lib/s3-bucket-diver/
      - install -Dm644 resources/icon.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/io.github.jonathands.S3BucketDiver.svg
    sources:
      - type: dir
        path: .